# ğŸ“· BÃO CÃO LUá»’NG Xá»¬ LÃ CHá»¨C NÄ‚NG CAMERA

## Má»¥c lá»¥c
1. [Tá»•ng quan](#1-tá»•ng-quan)
2. [SÆ¡ Ä‘á»“ luá»“ng startCamera()](#2-sÆ¡-Ä‘á»“-luá»“ng-startcamera)
3. [SÆ¡ Ä‘á»“ luá»“ng takePhoto()](#3-sÆ¡-Ä‘á»“-luá»“ng-takephoto)
4. [SÆ¡ Ä‘á»“ luá»“ng captureVideo()](#4-sÆ¡-Ä‘á»“-luá»“ng-capturevideo)
5. [SÆ¡ Ä‘á»“ luá»“ng flipCamera()](#5-sÆ¡-Ä‘á»“-luá»“ng-flipcamera)
6. [SÆ¡ Ä‘á»“ luá»“ng openGallery()](#6-sÆ¡-Ä‘á»“-luá»“ng-opengallery)
7. [Tá»•ng káº¿t](#7-tá»•ng-káº¿t)

---

## 1. Tá»•ng quan

### 1.1. Giá»›i thiá»‡u
TÃ i liá»‡u nÃ y trÃ¬nh bÃ y luá»“ng xá»­ lÃ½ cá»§a cÃ¡c chá»©c nÄƒng chÃ­nh trong `CameraController` cá»§a á»©ng dá»¥ng CameraX. Má»¥c tiÃªu cá»§a bÃ¡o cÃ¡o lÃ  mÃ´ táº£ má»™t cÃ¡ch rÃµ rÃ ng cÃ¡ch á»©ng dá»¥ng khá»Ÿi táº¡o camera, chá»¥p áº£nh, quay video, láº­t camera trÆ°á»›c/sau vÃ  má»Ÿ thÆ° viá»‡n. Pháº§n mÃ´ táº£ Æ°u tiÃªn dáº¡ng Ä‘oáº¡n vÄƒn theo ngá»¯ cáº£nh triá»ƒn khai thá»±c táº¿: nÃªu Ä‘áº§u vÃ o (input), cÃ¡c bÆ°á»›c xá»­ lÃ½ quan trá»ng, tÃ¡c Ä‘á»™ng lÃªn tráº¡ng thÃ¡i trong bá»™ nhá»› vÃ  cuá»‘i cÃ¹ng lÃ  hiá»‡u á»©ng quan sÃ¡t Ä‘Æ°á»£c trÃªn giao diá»‡n.

### 1.2. Kiáº¿n trÃºc tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CAMERA CONTROLLER                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                         COMPONENTS                                       â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚ ImageCapture â”‚  â”‚ VideoCapture â”‚  â”‚   Preview    â”‚  â”‚   Recorder  â”‚ â”‚â”‚
â”‚  â”‚  â”‚  (Chá»¥p áº£nh)  â”‚  â”‚  (Quay video)â”‚  â”‚  (Xem trÆ°á»›c) â”‚  â”‚ (Ghi video) â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                          FUNCTIONS                                       â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚startCamera â”‚ â”‚ takePhoto â”‚ â”‚ captureVideo â”‚ â”‚flipCameraâ”‚ â”‚openGalleryâ”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                           STATE                                          â”‚â”‚
â”‚  â”‚  â€¢ currentMode: PHOTO | VIDEO                                            â”‚â”‚
â”‚  â”‚  â€¢ currentSite: FRONT | BACK                                             â”‚â”‚
â”‚  â”‚  â€¢ recording: Recording? (null = khÃ´ng quay)                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3. MÃ´ táº£ tráº¡ng thÃ¡i vÃ  dá»¯ liá»‡u then chá»‘t
Trong quÃ¡ trÃ¬nh cháº¡y, `CameraController` duy trÃ¬ má»™t sá»‘ biáº¿n tráº¡ng thÃ¡i Ä‘á»ƒ quyáº¿t Ä‘á»‹nh hÃ nh vi cá»§a cÃ¡c nÃºt Ä‘iá»u khiá»ƒn. `imageCapture` lÃ  use case chá»‹u trÃ¡ch nhiá»‡m chá»¥p áº£nh; náº¿u biáº¿n nÃ y chÆ°a Ä‘Æ°á»£c khá»Ÿi táº¡o (thÆ°á»ng do chÆ°a gá»i `startCamera()` hoáº·c bind tháº¥t báº¡i), thao tÃ¡c chá»¥p áº£nh sáº½ khÃ´ng thá»±c hiá»‡n Ä‘Æ°á»£c. `videoCapture` lÃ  use case quay video; tÆ°Æ¡ng tá»±, náº¿u nÃ³ null thÃ¬ viá»‡c quay sáº½ bá»‹ bá» qua. Biáº¿n `recording` Ä‘áº¡i diá»‡n cho phiÃªn quay hiá»‡n táº¡i: khi `recording == null` nghÄ©a lÃ  Ä‘ang á»Ÿ tráº¡ng thÃ¡i idle, cÃ²n khi `recording != null` nghÄ©a lÃ  Ä‘ang quay vÃ  nÃºt quay sáº½ Ä‘Ã³ng vai trÃ² dá»«ng quay. `currentMode` cho biáº¿t giao diá»‡n Ä‘ang á»Ÿ cháº¿ Ä‘á»™ chá»¥p áº£nh hay quay video, cÃ²n `currentSite` cho biáº¿t camera trÆ°á»›c hay sau Ä‘ang Ä‘Æ°á»£c chá»n. CÃ¡c biáº¿n nÃ y phá»‘i há»£p vá»›i nhau Ä‘á»ƒ Ä‘áº£m báº£o UI vÃ  logic Ä‘á»“ng bá»™.

---

## 2. SÆ¡ Ä‘á»“ luá»“ng startCamera()

### 2.1. MÃ´ táº£ chá»©c nÄƒng
`startCamera()` lÃ  Ä‘iá»ƒm vÃ o (entry-point) quan trá»ng nháº¥t cá»§a toÃ n bá»™ tÃ­nh nÄƒng camera. Khi Ä‘Æ°á»£c gá»i, hÃ m sáº½ xin `ProcessCameraProvider` tá»« há»‡ thá»‘ng vÃ  Ä‘á»£i provider sáºµn sÃ ng thÃ´ng qua cÆ¡ cháº¿ `ListenableFuture`. Khi provider Ä‘Ã£ sáºµn sÃ ng, á»©ng dá»¥ng khá»Ÿi táº¡o ba use case chÃ­nh: `Preview` Ä‘á»ƒ hiá»ƒn thá»‹ hÃ¬nh áº£nh lÃªn `PreviewView`, `ImageCapture` Ä‘á»ƒ chá»¥p áº£nh, vÃ  `VideoCapture` (thÃ´ng qua `Recorder`) Ä‘á»ƒ quay video. Sau Ä‘Ã³, camera Ä‘Æ°á»£c chá»n dá»±a trÃªn `currentSite`. Cuá»‘i cÃ¹ng, controller gá»i `unbindAll()` Ä‘á»ƒ Ä‘áº£m báº£o khÃ´ng cÃ²n use case cÅ© nÃ o Ä‘ang tá»“n táº¡i vÃ  bind láº¡i toÃ n bá»™ use case vÃ o lifecycle cá»§a `MainActivity`. Káº¿t quáº£ lÃ  preview hiá»ƒn thá»‹, vÃ  cÃ¡c chá»©c nÄƒng chá»¥p/quay sáºµn sÃ ng hoáº¡t Ä‘á»™ng.

### 2.2. SÆ¡ Ä‘á»“ luá»“ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           startCamera()                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ProcessCameraProvider.getInstance(activity)                  â”‚
â”‚                    Láº¥y instance cá»§a CameraProvider                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              cameraProviderFuture.addListener({ ... }, executor)             â”‚
â”‚                    ÄÄƒng kÃ½ listener cháº¡y trÃªn Main Thread                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      CameraProvider Ready     â”‚
                    â”‚   cameraProviderFuture.get()  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚                           â”‚
        â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Preview.Builder â”‚   â”‚ ImageCapture      â”‚   â”‚    Recorder.Builder       â”‚
â”‚     .build()      â”‚   â”‚   .Builder()      â”‚   â”‚ .setQualitySelector(      â”‚
â”‚                   â”‚   â”‚   .build()        â”‚   â”‚   QualitySelector.from(   â”‚
â”‚ Táº¡o Preview       â”‚   â”‚                   â”‚   â”‚     Quality.HIGHEST))     â”‚
â”‚ Ä‘á»ƒ hiá»ƒn thá»‹       â”‚   â”‚ Táº¡o ImageCapture  â”‚   â”‚   .build()                â”‚
â”‚ hÃ¬nh áº£nh camera   â”‚   â”‚ Ä‘á»ƒ chá»¥p áº£nh       â”‚   â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ Táº¡o Recorder cháº¥t lÆ°á»£ng   â”‚
          â”‚                       â”‚             â”‚ cao nháº¥t                   â”‚
          â”‚                       â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                       â”‚                           â”‚
          â”‚                       â”‚                           â–¼
          â”‚                       â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                       â”‚             â”‚ VideoCapture.withOutput   â”‚
          â”‚                       â”‚             â”‚   (recorder)              â”‚
          â”‚                       â”‚             â”‚                           â”‚
          â”‚                       â”‚             â”‚ Táº¡o VideoCapture vá»›i      â”‚
          â”‚                       â”‚             â”‚ Recorder Ä‘Ã£ táº¡o           â”‚
          â”‚                       â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                       â”‚                           â”‚
          â–¼                       â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        preview.surfaceProvider =                             â”‚
â”‚                     viewBinding.viewFinder.surfaceProvider                   â”‚
â”‚                                                                              â”‚
â”‚              Káº¿t ná»‘i Preview vá»›i PreviewView trong layout                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    XÃ¡c Ä‘á»‹nh CameraSelector                                   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  if (currentSite == CameraSite.BACK)                                â”‚   â”‚
â”‚   â”‚      CameraSelector.DEFAULT_BACK_CAMERA                             â”‚   â”‚
â”‚   â”‚  else                                                               â”‚   â”‚
â”‚   â”‚      CameraSelector.DEFAULT_FRONT_CAMERA                            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      cameraProvider.unbindAll()                              â”‚
â”‚                                                                              â”‚
â”‚              Giáº£i phÃ³ng táº¥t cáº£ use cases Ä‘ang Ä‘Æ°á»£c bind                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   cameraProvider.bindToLifecycle(                            â”‚
â”‚                       activity,           // LifecycleOwner                  â”‚
â”‚                       cameraSelector,     // Camera trÆ°á»›c/sau                â”‚
â”‚                       preview,            // Use case xem trÆ°á»›c              â”‚
â”‚                       imageCapture,       // Use case chá»¥p áº£nh               â”‚
â”‚                       videoCapture        // Use case quay video             â”‚
â”‚                   )                                                          â”‚
â”‚                                                                              â”‚
â”‚              Bind táº¥t cáº£ use cases vÃ o lifecycle cá»§a Activity                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CAMERA STARTED âœ…                                    â”‚
â”‚                                                                              â”‚
â”‚              Camera sáºµn sÃ ng hoáº¡t Ä‘á»™ng vá»›i táº¥t cáº£ chá»©c nÄƒng                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3. Diá»…n giáº£i luá»“ng xá»­ lÃ½ theo Ä‘oáº¡n vÄƒn
Vá» báº£n cháº¥t, `startCamera()` hoáº¡t Ä‘á»™ng nhÆ° má»™t quy trÃ¬nh â€œthiáº¿t láº­p pipelineâ€: nÃ³ táº¡o Ä‘Æ°á»ng Ä‘i tá»« camera hardware â†’ CameraX use cases â†’ `PreviewView`. BÆ°á»›c Ä‘áº§u tiÃªn lÃ  xin `ProcessCameraProvider`, Ä‘Ã¢y lÃ  Ä‘á»‘i tÆ°á»£ng quáº£n lÃ½ viá»‡c bind/unbind use case vÃ  Ä‘iá»u phá»‘i camera lifecycle. VÃ¬ provider Ä‘Æ°á»£c cung cáº¥p báº¥t Ä‘á»“ng bá»™, code Ä‘Æ°á»£c Ä‘áº·t trong `addListener` Ä‘á»ƒ cháº¡y Ä‘Ãºng thá»i Ä‘iá»ƒm. Khi cháº¡y vÃ o listener, controller thiáº¿t láº­p `Preview` vÃ  gáº¯n `surfaceProvider` cá»§a `PreviewView` Ä‘á»ƒ CameraX biáº¿t render khung hÃ¬nh vÃ o Ä‘Ã¢u. Tiáº¿p theo, controller táº¡o `Recorder` vá»›i cháº¥t lÆ°á»£ng cao nháº¥t, sau Ä‘Ã³ bá»c recorder nÃ y vÃ o `VideoCapture`. `ImageCapture` Ä‘Æ°á»£c táº¡o Ä‘á»ƒ phá»¥c vá»¥ chá»¥p áº£nh. Dá»±a trÃªn `currentSite`, controller chá»n `CameraSelector.DEFAULT_BACK_CAMERA` hoáº·c `DEFAULT_FRONT_CAMERA`. TrÆ°á»›c khi bind, `unbindAll()` Ä‘Æ°á»£c gá»i Ä‘á»ƒ trÃ¡nh tÃ¬nh tráº¡ng â€œuse case already boundâ€ hoáº·c bind trÃ¹ng. Cuá»‘i cÃ¹ng, `bindToLifecycle()` gáº¯n preview, imageCapture vÃ  videoCapture vÃ o lifecycle cá»§a activity, khiáº¿n CameraX tá»± Ä‘á»™ng má»Ÿ camera khi activity á»Ÿ foreground vÃ  giáº£i phÃ³ng tÃ i nguyÃªn khi activity bá»‹ huá»·.

### 2.4. Xá»­ lÃ½ lá»—i
Náº¿u báº¥t ká»³ bÆ°á»›c nÃ o trong quÃ¡ trÃ¬nh bind nÃªu trÃªn tháº¥t báº¡i (vÃ­ dá»¥ khÃ´ng Ä‘á»§ quyá»n, camera Ä‘ang bá»‹ app khÃ¡c chiáº¿m dá»¥ng, hoáº·c thiáº¿t bá»‹ khÃ´ng há»— trá»£ use case), exception sáº½ Ä‘Æ°á»£c báº¯t vÃ  ghi log. á»¨ng dá»¥ng hiá»‡n táº¡i chá»§ yáº¿u ghi log cháº©n Ä‘oÃ¡n; trong thá»±c táº¿, báº¡n cÃ³ thá»ƒ bá»• sung thÃ´ng bÃ¡o UI Ä‘á»ƒ ngÆ°á»i dÃ¹ng hiá»ƒu camera chÆ°a sáºµn sÃ ng.

---

## 3. SÆ¡ Ä‘á»“ luá»“ng takePhoto()

### 3.1. MÃ´ táº£ chá»©c nÄƒng
`takePhoto()` chá»¥p má»™t áº£nh tÄ©nh vÃ  lÆ°u vÃ o `MediaStore` Ä‘á»ƒ áº£nh xuáº¥t hiá»‡n trong thÆ° viá»‡n há»‡ thá»‘ng. HÃ m báº¯t Ä‘áº§u báº±ng viá»‡c kiá»ƒm tra `imageCapture` cÃ³ sáºµn hay khÃ´ng; náº¿u chÆ°a cÃ³ (null) thÃ¬ káº¿t thÃºc sá»›m nháº±m trÃ¡nh crash. Khi Ä‘Ã£ cÃ³ use case, controller táº¡o tÃªn file báº±ng timestamp Ä‘á»ƒ Ä‘áº£m báº£o khÃ´ng trÃ¹ng, sau Ä‘Ã³ táº¡o `ContentValues` mÃ´ táº£ metadata cá»§a áº£nh (tÃªn hiá»ƒn thá»‹, MIME type vÃ  Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i náº¿u Android 10+). Dá»±a trÃªn nhá»¯ng metadata nÃ y, controller táº¡o `OutputFileOptions` vÃ  gá»i `imageCapture.takePicture()` theo kiá»ƒu báº¥t Ä‘á»“ng bá»™. Khi áº£nh Ä‘Æ°á»£c lÆ°u thÃ nh cÃ´ng, callback `onImageSaved()` Ä‘Æ°á»£c gá»i vÃ  controller cáº­p nháº­t thumbnail cá»§a `photoViewButton` báº±ng `savedUri`, giÃºp ngÆ°á»i dÃ¹ng tháº¥y áº£nh má»›i nháº¥t ngay trÃªn UI.

### 3.2. SÆ¡ Ä‘á»“ luá»“ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              takePhoto()                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    val imageCapture = imageCapture ?: return                 â”‚
â”‚                                                                              â”‚
â”‚              Kiá»ƒm tra ImageCapture Ä‘Ã£ Ä‘Æ°á»£c khá»Ÿi táº¡o chÆ°a                     â”‚
â”‚              Náº¿u null â†’ ThoÃ¡t hÃ m ngay                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Táº¡o tÃªn file                                        â”‚
â”‚                                                                              â”‚
â”‚   val name = SimpleDateFormat("dd-MM-yyyy-HH-mm-ss-SSS", Locale.US)         â”‚
â”‚              .format(System.currentTimeMillis())                             â”‚
â”‚                                                                              â”‚
â”‚   VÃ­ dá»¥: "18-01-2026-14-30-45-123"                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Táº¡o ContentValues                                     â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  ContentValues().apply {                                            â”‚   â”‚
â”‚   â”‚      put(DISPLAY_NAME, name)              // TÃªn file               â”‚   â”‚
â”‚   â”‚      put(MIME_TYPE, "image/jpeg")         // Äá»‹nh dáº¡ng JPEG         â”‚   â”‚
â”‚   â”‚      if (SDK_INT > P) {                                             â”‚   â”‚
â”‚   â”‚          put(RELATIVE_PATH, "CameraX")    // ThÆ° má»¥c lÆ°u            â”‚   â”‚
â”‚   â”‚      }                                                              â”‚   â”‚
â”‚   â”‚  }                                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Táº¡o OutputFileOptions                                   â”‚
â”‚                                                                              â”‚
â”‚   ImageCapture.OutputFileOptions.Builder(                                    â”‚
â”‚       activity.contentResolver,              // ContentResolver              â”‚
â”‚       MediaStore.Images.Media.EXTERNAL_CONTENT_URI,  // URI thÆ° viá»‡n áº£nh    â”‚
â”‚       contentValues                          // Metadata cá»§a file            â”‚
â”‚   ).build()                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       imageCapture.takePicture(                              â”‚
â”‚                           outputOptions,                                     â”‚
â”‚                           mainExecutor,                                      â”‚
â”‚                           callback                                           â”‚
â”‚                       )                                                      â”‚
â”‚                                                                              â”‚
â”‚              Thá»±c hiá»‡n chá»¥p áº£nh (async)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       onError()       â”‚       â”‚    onImageSaved()     â”‚
        â”‚                       â”‚       â”‚                       â”‚
        â”‚  Chá»¥p áº£nh tháº¥t báº¡i    â”‚       â”‚  Chá»¥p áº£nh thÃ nh cÃ´ng  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Log.e(TAG,            â”‚       â”‚ val savedUri = output.savedUri    â”‚
        â”‚   "Photo capture      â”‚       â”‚                                   â”‚
        â”‚    failed: ${msg}")   â”‚       â”‚ Láº¥y URI cá»§a áº£nh Ä‘Ã£ lÆ°u            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚     savedUri != null ?            â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚ YES                   â”‚ NO
                                            â–¼                       â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ runOnUiThread {       â”‚   â”‚   Bá» qua      â”‚
                                â”‚   photoViewButton     â”‚   â”‚               â”‚
                                â”‚     .setImageURI(uri) â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚   photoViewButton     â”‚
                                â”‚     .clipToOutline    â”‚
                                â”‚       = true          â”‚
                                â”‚ }                     â”‚
                                â”‚                       â”‚
                                â”‚ Cáº­p nháº­t thumbnail    â”‚
                                â”‚ trÃªn nÃºt thÆ° viá»‡n     â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚              PHOTO SAVED âœ…               â”‚
                                â”‚                                           â”‚
                                â”‚  File: Pictures/CameraX/18-01-2026-...jpg â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3. Diá»…n giáº£i luá»“ng xá»­ lÃ½ theo Ä‘oáº¡n vÄƒn
Äiá»ƒm quan trá»ng cá»§a `takePhoto()` lÃ  cÃ¡ch nÃ³ tÃ­ch há»£p vá»›i `MediaStore` thay vÃ¬ tá»± ghi file Ä‘Æ°á»ng dáº«n thÃ´. Äiá»u nÃ y tÆ°Æ¡ng thÃ­ch tá»‘t vá»›i Scoped Storage trÃªn Android 10+. á»¨ng dá»¥ng Ä‘Æ°a `MediaStore.Images.Media.EXTERNAL_CONTENT_URI` vÃ o `OutputFileOptions.Builder`, káº¿t há»£p `ContentValues` Ä‘á»ƒ há»‡ thá»‘ng táº¡o báº£n ghi (entry) trong thÆ° viá»‡n áº£nh. Lá»‡nh `takePicture()` sáº½ chá»¥p áº£nh trÃªn pipeline CameraX, mÃ£ hoÃ¡ thÃ nh JPEG vÃ  lÆ°u káº¿t quáº£ qua content resolver. Callback `onError()` ghi log sá»± cá»‘, cÃ²n callback `onImageSaved()` nháº­n vá» `OutputFileResults` chá»©a `savedUri`. Náº¿u `savedUri` khÃ´ng null, UI Ä‘Æ°á»£c cáº­p nháº­t trÃªn main thread Ä‘á»ƒ hiá»ƒn thá»‹ áº£nh má»›i nháº¥t. ÄÃ¢y lÃ  lÃ½ do ngÆ°á»i dÃ¹ng báº¥m nÃºt thÆ° viá»‡n sáº½ tháº¥y â€œthumbnailâ€ vá»«a Ä‘Æ°á»£c cáº­p nháº­t.

### 3.4. MÃ´ táº£ lÆ°u trá»¯ áº£nh
Sau khi lÆ°u, áº£nh Ä‘Æ°á»£c quáº£n lÃ½ bá»Ÿi há»‡ thá»‘ng vÃ  thÆ°á»ng náº±m trong `Pictures/CameraX` (vá»›i Android 10+) nhá» `RELATIVE_PATH`. Vá»›i Android 9 trá»Ÿ xuá»‘ng, viá»‡c lÆ°u váº«n thÃ´ng qua MediaStore nhÆ°ng khÃ´ng dÃ¹ng RELATIVE_PATH; áº£nh váº«n xuáº¥t hiá»‡n trong thÆ° viá»‡n, chá»‰ Ä‘Æ°á»ng dáº«n váº­t lÃ½ cÃ³ thá»ƒ khÃ¡c theo thiáº¿t bá»‹.

---

## 4. SÆ¡ Ä‘á»“ luá»“ng captureVideo()

### 4.1. MÃ´ táº£ chá»©c nÄƒng
`captureVideo()` Ä‘Æ°á»£c thiáº¿t káº¿ nhÆ° má»™t nÃºt toggle: khi ngÆ°á»i dÃ¹ng báº¥m láº§n Ä‘áº§u, nÃ³ báº¯t Ä‘áº§u quay; khi báº¥m láº§n ná»¯a, nÃ³ dá»«ng quay. VÃ¬ váº­y, tráº¡ng thÃ¡i `recording` lÃ  chÃ¬a khoÃ¡ quyáº¿t Ä‘á»‹nh nhÃ¡nh xá»­ lÃ½. HÃ m cÅ©ng quáº£n lÃ½ UI liÃªn quan Ä‘áº¿n quay video, bao gá»“m vÃ´ hiá»‡u hoÃ¡ chuyá»ƒn mode trong lÃºc quay, Ä‘á»•i icon cá»§a nÃºt quay/dá»«ng, hiá»ƒn thá»‹ indicator vÃ  cháº¡y `RecordingTimer` Ä‘á»ƒ cáº­p nháº­t thá»i gian á»Ÿ giá»¯a preview.

### 4.2. SÆ¡ Ä‘á»“ luá»“ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            captureVideo()                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  val videoCapture = this.videoCapture ?: return              â”‚
â”‚                                                                              â”‚
â”‚              Kiá»ƒm tra VideoCapture Ä‘Ã£ Ä‘Æ°á»£c khá»Ÿi táº¡o chÆ°a                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 viewBinding.modeSelectorGroup.isEnabled = false              â”‚
â”‚                                                                              â”‚
â”‚              VÃ´ hiá»‡u hÃ³a nÃºt chuyá»ƒn cháº¿ Ä‘á»™ Photo/Video                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      val curRecording = recording                            â”‚
â”‚                          curRecording != null ?                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ YES (Äang quay)               â”‚ NO (ChÆ°a quay)
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     STOP RECORDING                â”‚   â”‚     START RECORDING                 â”‚
â”‚                                   â”‚   â”‚                                     â”‚
â”‚  curRecording.stop()              â”‚   â”‚  (Tiáº¿p tá»¥c bÃªn dÆ°á»›i)                â”‚
â”‚  recording = null                 â”‚   â”‚                                     â”‚
â”‚  return                           â”‚   â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Táº¡o tÃªn file video                                  â”‚
â”‚                                                                              â”‚
â”‚   val name = SimpleDateFormat("dd-MM-yyyy-HH-mm-ss-SSS", Locale.US)         â”‚
â”‚              .format(System.currentTimeMillis())                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Táº¡o ContentValues                                     â”‚
â”‚                                                                              â”‚
â”‚   ContentValues().apply {                                                    â”‚
â”‚       put(DISPLAY_NAME, name)                                               â”‚
â”‚       put(MIME_TYPE, "video/mp4")          // Äá»‹nh dáº¡ng MP4                 â”‚
â”‚       if (SDK_INT > P) {                                                    â”‚
â”‚           put(RELATIVE_PATH, "CameraX")    // ThÆ° má»¥c lÆ°u                   â”‚
â”‚       }                                                                      â”‚
â”‚   }                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Táº¡o MediaStoreOutputOptions                               â”‚
â”‚                                                                              â”‚
â”‚   MediaStoreOutputOptions.Builder(                                           â”‚
â”‚       activity.contentResolver,                                              â”‚
â”‚       MediaStore.Video.Media.EXTERNAL_CONTENT_URI                           â”‚
â”‚   ).setContentValues(contentValues).build()                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Chuáº©n bá»‹ Recording                                      â”‚
â”‚                                                                              â”‚
â”‚   videoCapture.output                                                        â”‚
â”‚       .prepareRecording(activity, mediaStoreOutputOptions)                   â”‚
â”‚       .apply {                                                               â”‚
â”‚           if (RECORD_AUDIO permission granted) {                             â”‚
â”‚               withAudioEnabled()    // Báº­t ghi Ã¢m                            â”‚
â”‚           }                                                                  â”‚
â”‚       }                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         .start(executor) { recordEvent -> }                  â”‚
â”‚                                                                              â”‚
â”‚              Báº¯t Ä‘áº§u quay vÃ  láº¯ng nghe events                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VideoRecordEvent.Start          â”‚   â”‚   VideoRecordEvent.Finalize         â”‚
â”‚                                   â”‚   â”‚                                     â”‚
â”‚   Báº¯t Ä‘áº§u quay thÃ nh cÃ´ng         â”‚   â”‚   Káº¿t thÃºc quay (stop hoáº·c error)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                           â”‚
                â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ recordingTimer.start()          â”‚   â”‚ if (!recordEvent.hasError()) {      â”‚
â”‚   â†’ Báº¯t Ä‘áº§u Ä‘áº¿m thá»i gian         â”‚   â”‚                                     â”‚
â”‚                                   â”‚   â”‚   â€¢ recordingTimer.stop()           â”‚
â”‚ â€¢ recordingIndicator.visibility   â”‚   â”‚   â€¢ recordingIndicator.GONE         â”‚
â”‚     = View.VISIBLE                â”‚   â”‚   â€¢ recording = null                â”‚
â”‚   â†’ Hiá»‡n indicator Ä‘á»             â”‚   â”‚   â€¢ updateCaptureButtonUI()         â”‚
â”‚                                   â”‚   â”‚   â€¢ modeSelectorGroup.enabled=true  â”‚
â”‚ â€¢ updateCaptureButtonUI()         â”‚   â”‚                                     â”‚
â”‚   â†’ Äá»•i icon thÃ nh "stop"         â”‚   â”‚   â€¢ Láº¥y thumbnail tá»« video          â”‚
â”‚                                   â”‚   â”‚   â€¢ Cáº­p nháº­t photoViewButton        â”‚
â”‚ â€¢ modeSelectorGroup.enabled=false â”‚   â”‚                                     â”‚
â”‚   â†’ KhÃ³a nÃºt chuyá»ƒn mode          â”‚   â”‚ } else {                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â€¢ recording?.close()              â”‚
                                        â”‚   â€¢ Log error                       â”‚
                                        â”‚ }                                   â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                                            â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚      THUMBNAIL EXTRACTION           â”‚
                                        â”‚                                     â”‚
                                        â”‚  cameraExecutor.execute {           â”‚
                                        â”‚    val retriever =                  â”‚
                                        â”‚      MediaMetadataRetriever()       â”‚
                                        â”‚    retriever.setDataSource(         â”‚
                                        â”‚      activity, savedUri)            â”‚
                                        â”‚    val frame = retriever            â”‚
                                        â”‚      .getFrameAtTime(0)             â”‚
                                        â”‚    photoViewButton                  â”‚
                                        â”‚      .setImageBitmap(frame)         â”‚
                                        â”‚    retriever.release()              â”‚
                                        â”‚  }                                  â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3. Diá»…n giáº£i luá»“ng xá»­ lÃ½ theo Ä‘oáº¡n vÄƒn
Khi `captureVideo()` Ä‘Æ°á»£c gá»i, bÆ°á»›c Ä‘áº§u tiÃªn lÃ  kiá»ƒm tra `videoCapture` cÃ³ sáºµn hay khÃ´ng. Náº¿u chÆ°a cÃ³, hÃ m thoÃ¡t sá»›m, vÃ¬ khÃ´ng thá»ƒ khá»Ÿi táº¡o pipeline quay video. Tiáº¿p theo, controller khoÃ¡ `modeSelectorGroup` Ä‘á»ƒ ngÆ°á»i dÃ¹ng khÃ´ng Ä‘á»•i giá»¯a PHOTO/VIDEO trong lÃºc Ä‘ang chuáº©n bá»‹ hoáº·c Ä‘ang quay. Náº¿u `recording` Ä‘ang khÃ¡c null, Ä‘iá»u Ä‘Ã³ nghÄ©a lÃ  Ä‘Ã£ cÃ³ phiÃªn quay Ä‘ang cháº¡y; khi Ä‘Ã³, controller gá»i `stop()` trÃªn phiÃªn hiá»‡n táº¡i vÃ  Ä‘áº·t `recording = null`, rá»“i return ngay.

Náº¿u `recording` Ä‘ang null, controller sáº½ táº¡o `ContentValues` cho video (DISPLAY_NAME, MIME_TYPE = `video/mp4`, vÃ  RELATIVE_PATH náº¿u Android 10+), rá»“i táº¡o `MediaStoreOutputOptions`. Sau Ä‘Ã³, controller gá»i `videoCapture.output.prepareRecording(...)` Ä‘á»ƒ chuáº©n bá»‹ recording session. Náº¿u quyá»n `RECORD_AUDIO` Ä‘Æ°á»£c cáº¥p, controller báº­t audio báº±ng `withAudioEnabled()` Ä‘á»ƒ video cÃ³ tiáº¿ng. Cuá»‘i cÃ¹ng, controller gá»i `start()` vÃ  láº¯ng nghe cÃ¡c sá»± kiá»‡n `VideoRecordEvent`.

Khi nháº­n `VideoRecordEvent.Start`, controller báº¯t Ä‘áº§u `RecordingTimer`, hiá»ƒn thá»‹ `recordingIndicator`, vÃ  cáº­p nháº­t UI nÃºt quay Ä‘á»ƒ chuyá»ƒn sang tráº¡ng thÃ¡i â€œdá»«ngâ€. Khi nháº­n `VideoRecordEvent.Finalize`, controller dá»«ng timer, áº©n indicator, giáº£i phÃ³ng `recording`, vÃ  cho phÃ©p báº­t láº¡i chuyá»ƒn mode. Náº¿u finalize thÃ nh cÃ´ng, controller cÃ²n trÃ­ch má»™t frame Ä‘áº§u tiÃªn cá»§a video báº±ng `MediaMetadataRetriever` (cháº¡y trÃªn `cameraExecutor`) Ä‘á»ƒ Ä‘áº·t lÃ m thumbnail cho `photoViewButton`. Náº¿u finalize cÃ³ lá»—i, recording sáº½ Ä‘Æ°á»£c Ä‘Ã³ng vÃ  log lá»—i Ä‘Æ°á»£c ghi láº¡i.

### 4.4. MÃ´ táº£ tráº¡ng thÃ¡i vÃ  UI khi quay
Trong tráº¡ng thÃ¡i idle, nÃºt quay hiá»ƒn thá»‹ icon báº¯t Ä‘áº§u quay vÃ  Ä‘á»“ng thá»i cho phÃ©p Ä‘á»•i mode. Trong tráº¡ng thÃ¡i recording, nÃºt quay Ä‘á»•i sang icon dá»«ng, timer/indicator hiá»ƒn thá»‹ trÃªn preview, vÃ  cÃ¡c thÃ nh pháº§n UI cÃ³ thá»ƒ gÃ¢y xung Ä‘á»™t (nhÆ° Ä‘á»•i mode) bá»‹ khoÃ¡ Ä‘á»ƒ trÃ¡nh lá»—i tráº¡ng thÃ¡i.

---

## 5. SÆ¡ Ä‘á»“ luá»“ng flipCamera()

### 5.1. MÃ´ táº£ chá»©c nÄƒng
`flipCamera()` chuyá»ƒn qua láº¡i giá»¯a camera sau vÃ  camera trÆ°á»›c. HÃ m thá»±c hiá»‡n má»™t animation xoay 180 Ä‘á»™ cho nÃºt Ä‘á»ƒ táº¡o pháº£n há»“i thá»‹ giÃ¡c, sau Ä‘Ã³ Ä‘áº£o tráº¡ng thÃ¡i `currentSite` vÃ  `lensFacing` tÆ°Æ¡ng á»©ng. Cuá»‘i cÃ¹ng, controller gá»i láº¡i `startCamera()` Ä‘á»ƒ unbind/bind láº¡i toÃ n bá»™ use case vá»›i `CameraSelector` má»›i. VÃ¬ thao tÃ¡c flip thá»±c cháº¥t lÃ  â€œrebind cameraâ€, preview sáº½ Ä‘Æ°á»£c khá»Ÿi Ä‘á»™ng láº¡i trong thá»i gian ngáº¯n.

### 5.2. SÆ¡ Ä‘á»“ luá»“ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             flipCamera()                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ANIMATION                                           â”‚
â”‚                                                                              â”‚
â”‚   viewBinding.flipCameraButton                                               â”‚
â”‚       .animate()                                                             â”‚
â”‚       .rotation(180f)           // Xoay 180 Ä‘á»™                               â”‚
â”‚       .setDuration(300)         // Trong 300ms                               â”‚
â”‚       .start()                                                               â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚     ğŸ”„  â”€â”€â”€â”€â”€â”€â–º  ğŸ”ƒ  â”€â”€â”€â”€â”€â”€â–º  ğŸ”„                                   â”‚   â”‚
â”‚   â”‚     0Â°           90Â°          180Â°                                  â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Kiá»ƒm tra currentSite hiá»‡n táº¡i                            â”‚
â”‚                                                                              â”‚
â”‚                      currentSite == CameraSite.BACK ?                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ YES (Camera sau)              â”‚ NO (Camera trÆ°á»›c)
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SWITCH TO FRONT CAMERA          â”‚   â”‚   SWITCH TO BACK CAMERA             â”‚
â”‚                                   â”‚   â”‚                                     â”‚
â”‚   currentSite = CameraSite.FRONT  â”‚   â”‚   currentSite = CameraSite.BACK     â”‚
â”‚   lensFacing =                    â”‚   â”‚   lensFacing =                      â”‚
â”‚     LENS_FACING_FRONT             â”‚   â”‚     LENS_FACING_BACK                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                           â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            startCamera()                                     â”‚
â”‚                                                                              â”‚
â”‚              Khá»Ÿi Ä‘á»™ng láº¡i camera vá»›i cÃ i Ä‘áº·t má»›i                            â”‚
â”‚              (Xem sÆ¡ Ä‘á»“ startCamera() á»Ÿ pháº§n 2)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CAMERA FLIPPED âœ…                                    â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   BACK CAMERA                      FRONT CAMERA                     â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚
â”‚   â”‚   â”‚   ğŸ“¸        â”‚     â—„â”€â”€â”€â”€â–º      â”‚    ğŸ¤³       â”‚                 â”‚   â”‚
â”‚   â”‚   â”‚  (Chá»¥p      â”‚                  â”‚  (Selfie    â”‚                 â”‚   â”‚
â”‚   â”‚   â”‚   phong     â”‚                  â”‚   camera)   â”‚                 â”‚   â”‚
â”‚   â”‚   â”‚   cáº£nh)     â”‚                  â”‚             â”‚                 â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3. Diá»…n giáº£i luá»“ng xá»­ lÃ½ theo Ä‘oáº¡n vÄƒn
á» má»©c logic, `flipCamera()` lÃ  má»™t toggle Ä‘Æ¡n giáº£n giá»¯a hai giÃ¡ trá»‹ enum. Náº¿u Ä‘ang á»Ÿ BACK, nÃ³ chuyá»ƒn sang FRONT; náº¿u Ä‘ang á»Ÿ FRONT, nÃ³ chuyá»ƒn vá» BACK. Ngay sau khi cáº­p nháº­t cÃ¡c biáº¿n tráº¡ng thÃ¡i, `startCamera()` Ä‘Æ°á»£c gá»i Ä‘á»ƒ CameraX Ã¡p dá»¥ng thay Ä‘á»•i. Äiá»u quan trá»ng lÃ  viá»‡c flip camera khÃ´ng chá»‰ Ä‘á»•i biáº¿n mÃ  cÃ²n buá»™c pháº£i rebind use case, bá»Ÿi camera selector Ä‘Ã£ thay Ä‘á»•i.

### 5.4. Ghi chÃº hÃ nh vi
Do má»™t sá»‘ thiáº¿t bá»‹ cÃ³ cáº¥u hÃ¬nh camera Ä‘a dáº¡ng, cháº¥t lÆ°á»£ng camera trÆ°á»›c thÆ°á»ng tháº¥p hÆ¡n camera sau vÃ  thá»i gian chuyá»ƒn Ä‘á»•i cÃ³ thá»ƒ khÃ¡c nhau. Tuy nhiÃªn, vá»›i thiáº¿t káº¿ hiá»‡n táº¡i, viá»‡c gá»i `startCamera()` Ä‘áº£m báº£o cÆ¡ cháº¿ chuyá»ƒn camera nháº¥t quÃ¡n vÃ  dá»… báº£o trÃ¬.

---

## 6. SÆ¡ Ä‘á»“ luá»“ng openGallery()

### 6.1. MÃ´ táº£ chá»©c nÄƒng
`openGallery()` má»Ÿ á»©ng dá»¥ng xem áº£nh cá»§a há»‡ thá»‘ng báº±ng `Intent.ACTION_VIEW`. HÃ m táº¡o má»™t intent vá»›i `type = "image/*"` Ä‘á»ƒ yÃªu cáº§u há»‡ thá»‘ng tÃ¬m má»™t activity cÃ³ thá»ƒ hiá»ƒn thá»‹ áº£nh. Khi gá»i `startActivity(intent)`, Android sáº½ thá»±c hiá»‡n intent resolution: náº¿u cÃ³ app máº·c Ä‘á»‹nh thÃ¬ má»Ÿ trá»±c tiáº¿p, náº¿u cÃ³ nhiá»u app phÃ¹ há»£p thÃ¬ há»‡ thá»‘ng cÃ³ thá»ƒ hiá»ƒn thá»‹ chooser (tuá»³ cáº¥u hÃ¬nh ngÆ°á»i dÃ¹ng), vÃ  náº¿u khÃ´ng cÃ³ app nÃ o xá»­ lÃ½ thÃ¬ thao tÃ¡c sáº½ tháº¥t báº¡i.

### 6.2. SÆ¡ Ä‘á»“ luá»“ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            openGallery()                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Táº¡o Intent                                          â”‚
â”‚                                                                              â”‚
â”‚   val intent = Intent(Intent.ACTION_VIEW)                                    â”‚
â”‚                                                                              â”‚
â”‚   ACTION_VIEW: YÃªu cáº§u há»‡ thá»‘ng hiá»ƒn thá»‹ dá»¯ liá»‡u                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Cáº¥u hÃ¬nh Intent                                       â”‚
â”‚                                                                              â”‚
â”‚   intent.type = "image/*"                                                    â”‚
â”‚                                                                              â”‚
â”‚   MIME type á»Ÿ Ä‘Ã¢y Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ nÃ³i vá»›i Android ráº±ng app muá»‘n â€œxem ná»™i dung   â”‚
â”‚   dáº¡ng áº£nhâ€. Vá»›i thiáº¿t láº­p hiá»‡n táº¡i, `image/*` nghÄ©a lÃ  cháº¥p nháº­n má»i Ä‘á»‹nh   â”‚
â”‚   dáº¡ng áº£nh phá»• biáº¿n nhÆ° JPEG/PNG/GIF. Náº¿u báº¡n chuyá»ƒn sang `video/*` thÃ¬ há»‡   â”‚
â”‚   thá»‘ng sáº½ Æ°u tiÃªn cÃ¡c app cÃ³ thá»ƒ xem video; cÃ²n náº¿u dÃ¹ng `*/*` thÃ¬ intent   â”‚
â”‚   sáº½ trá»Ÿ nÃªn tá»•ng quÃ¡t hÆ¡n vÃ  cÃ³ thá»ƒ match nhiá»u loáº¡i á»©ng dá»¥ng hÆ¡n.          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ThÃªm Flags                                          â”‚
â”‚                                                                              â”‚
â”‚   intent.flags = Intent.FLAG_ACTIVITY_NEW_TASK                               â”‚
â”‚                                                                              â”‚
â”‚   FLAG_ACTIVITY_NEW_TASK: Má»Ÿ Activity trong task má»›i                         â”‚
â”‚   (Cáº§n thiáº¿t khi khá»Ÿi Ä‘á»™ng tá»« non-Activity context)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Khá»Ÿi Ä‘á»™ng Activity                                    â”‚
â”‚                                                                              â”‚
â”‚   activity.startActivity(intent)                                             â”‚
â”‚                                                                              â”‚
â”‚   Gá»­i Intent Ä‘áº¿n há»‡ thá»‘ng Android                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ANDROID SYSTEM PROCESSING                                â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    Intent Resolution                                â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Android tÃ¬m cÃ¡c app cÃ³ thá»ƒ xá»­ lÃ½ ACTION_VIEW + image/*            â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚   â”‚   â”‚   Photos    â”‚ â”‚   Gallery   â”‚ â”‚ Google      â”‚ â”‚   Files     â”‚  â”‚   â”‚
â”‚   â”‚   â”‚   (Google)  â”‚ â”‚   (Samsung) â”‚ â”‚ Drive       â”‚ â”‚             â”‚  â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Náº¿u cÃ³ 1 app máº·c Ä‘á»‹nh â†’ Má»Ÿ trá»±c tiáº¿p                              â”‚   â”‚
â”‚   â”‚   Náº¿u cÃ³ nhiá»u app      â†’ Hiá»‡n chooser dialog                       â”‚   â”‚
â”‚   â”‚   Náº¿u khÃ´ng cÃ³ app      â†’ Hiá»‡n thÃ´ng bÃ¡o lá»—i                        â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GALLERY OPENED âœ…                                    â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚   â”‚                    ğŸ“· Photos                                â”‚   â”‚   â”‚
â”‚   â”‚   â”‚                                                             â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚  ğŸ“·   â”‚ â”‚  ğŸ“·   â”‚ â”‚  ğŸ¥   â”‚ â”‚  ğŸ“·   â”‚ â”‚  ğŸ“·   â”‚       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚       â”‚ â”‚       â”‚ â”‚       â”‚ â”‚       â”‚ â”‚       â”‚       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚                                                             â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚  ğŸ“·   â”‚ â”‚  ğŸ¥   â”‚ â”‚  ğŸ“·   â”‚ â”‚  ğŸ“·   â”‚ â”‚  ğŸ¥   â”‚       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚       â”‚ â”‚       â”‚ â”‚       â”‚ â”‚       â”‚ â”‚       â”‚       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚                                                             â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“š TÃ i liá»‡u tham kháº£o

CÃ¡c tÃ i liá»‡u sau lÃ  nguá»“n tham chiáº¿u chÃ­nh Ä‘á»ƒ Ä‘á»‘i chiáº¿u hÃ nh vi vÃ  API Ä‘Æ°á»£c sá»­ dá»¥ng trong bÃ¡o cÃ¡o nÃ y: trang CameraX Overview mÃ´ táº£ kiáº¿n trÃºc vÃ  cÃ¡c use case cÆ¡ báº£n; tÃ i liá»‡u `ImageCapture` vÃ  `VideoCapture` giáº£i thÃ­ch chi tiáº¿t cÃ¡ch cáº¥u hÃ¬nh vÃ  cháº¡y luá»“ng chá»¥p/quay; vÃ  `MediaStore API` cung cáº¥p cÆ¡ cháº¿ lÆ°u trá»¯ áº£nh/video theo chuáº©n há»‡ thá»‘ng, Ä‘áº·c biá»‡t quan trá»ng trÃªn Android 10+. Báº¡n cÃ³ thá»ƒ truy cáº­p tá»«ng tÃ i liá»‡u theo cÃ¡c liÃªn káº¿t sau: [CameraX Overview](https://developer.android.com/training/camerax), [ImageCapture](https://developer.android.com/reference/androidx/camera/core/ImageCapture), [VideoCapture](https://developer.android.com/reference/androidx/camera/video/VideoCapture) vÃ  [MediaStore API](https://developer.android.com/reference/android/provider/MediaStore).

**NgÃ y táº¡o**: 18/01/2026  
**PhiÃªn báº£n**: 1.0  
**TÃ¡c giáº£**: CameraX Development Team
